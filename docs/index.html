<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Android SDK: Android SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
â€‹
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectalign" style="padding-left: 0.5em; vertical-align: middle;">
   <div id="projectname"><a href="https://developers.mobiledgex.com"><svg xmlns="http://www.w3.org/2000/svg" width="185" height="35.93" viewBox="-15 -7 210 30.93"><defs><style>.cls-1{fill:#121620;}.cls-2{fill:#93e019;}</style></defs><title>Asset 163logo</title><g id="Layer_2" data-name="Layer 2"><g id="design"><path class="cls-1" d="M51,12.93a7.31,7.31,0,1,1-14.61,0,7.31,7.31,0,1,1,14.61,0Zm-3.39,0c0-2.91-1.85-4.4-3.93-4.4s-3.93,1.49-3.93,4.4,1.88,4.45,3.93,4.45S47.6,15.86,47.6,12.93ZM53,20V.05h3.31V7.69A5.09,5.09,0,0,1,60.7,5.58c4.22,0,6.5,3.21,6.5,7.35s-2.51,7.49-6.62,7.49a4.87,4.87,0,0,1-4.34-2.26l-1.88,1.89ZM60,8.56c-2.14,0-3.79,1.59-3.79,4.39s1.65,4.46,3.79,4.46,3.79-1.68,3.79-4.46S62.26,8.56,60,8.56Zm9.5-2.64V20.05h3.33V5.92Zm6,14.13V.05h3.36v20ZM107.56,0V7.61c-.43-.9-1.68-2-4.14-2-4,0-6.71,3.33-6.71,7.38,0,4.25,2.7,7.46,6.74,7.46a4.7,4.7,0,0,0,4.17-2.2h0L109.44,20h1.39V17.47h0V0Zm-3.7,17.44c-2.29,0-3.79-1.79-3.79-4.48s1.62-4.4,3.82-4.4,3.7,1.68,3.7,4.37S106.06,17.44,103.86,17.44ZM13.5.05h4.39L24,11.12,30,.05h4.39v20H30.89V5.74L24.65,17.28H23.23L17,5.74V20.05H13.5Zm59.33,0H69.54v3.3h3.29Zm52.29,5.87-1.64,1.64c-.43-.9-1.68-2-4.13-2a6.44,6.44,0,0,0-3.26.86,6.76,6.76,0,0,0-3.43,6c0,.18,0,.36,0,.55,0,4.25,2.72,7.46,6.77,7.46a4.78,4.78,0,0,0,3.83-1.75v.16c0,2.84-1.31,4.2-3.94,4.22h0a6,6,0,0,1-3.92-1.36c-.25-.2-.33-.3-.39-.35l-2.09,2.09c.14.15.22.23.37.37a8.61,8.61,0,0,0,6.08,2.17h0c5.29,0,7.23-3.5,7.23-7.26V5.92ZM119.78,17.4c-2.28,0-3.79-1.79-3.79-4.48,0-2.35,1.24-3.95,3-4.32a6.07,6.07,0,0,1,.71,0,4.08,4.08,0,0,1,2.15.61,4.45,4.45,0,0,1,1.52,3.73C123.38,15.58,122,17.4,119.78,17.4Zm-29.29-.33a5.1,5.1,0,0,1-2,.42,3.86,3.86,0,0,1-2.58-.88,4.21,4.21,0,0,1-1.38-2.44H94.72a8.66,8.66,0,0,0,.1-1.06,8.11,8.11,0,0,0-1.67-5.47,6.36,6.36,0,0,0-5.06-2.1,7,7,0,0,0-3.65.94,6.43,6.43,0,0,0-2.51,2.63A8.17,8.17,0,0,0,81,13a8.14,8.14,0,0,0,.88,3.86,6.39,6.39,0,0,0,2.5,2.6,7.39,7.39,0,0,0,3.75.92,8,8,0,0,0,3.3-.65,7.46,7.46,0,0,0,2.59-1.86l-1.93-1.93A5,5,0,0,1,90.49,17.07ZM85.64,9.23a3.47,3.47,0,0,1,2.48-.94,3.28,3.28,0,0,1,2.47,1,3.6,3.6,0,0,1,1,2.54H84.46A3.83,3.83,0,0,1,85.64,9.23Zm52.2,7.84a5.1,5.1,0,0,1-2,.42,3.86,3.86,0,0,1-2.58-.88,4.21,4.21,0,0,1-1.38-2.44h10.23a8.66,8.66,0,0,0,.1-1.06,8.06,8.06,0,0,0-1.68-5.47,6.32,6.32,0,0,0-5.05-2.1,7.07,7.07,0,0,0-3.66.94,6.47,6.47,0,0,0-2.5,2.63,8.17,8.17,0,0,0-.89,3.86,8.14,8.14,0,0,0,.88,3.86,6.39,6.39,0,0,0,2.5,2.6,7.39,7.39,0,0,0,3.75.92,8.07,8.07,0,0,0,3.3-.65,7.56,7.56,0,0,0,2.59-1.86l-1.93-1.93A5,5,0,0,1,137.84,17.07ZM133,9.23a3.44,3.44,0,0,1,2.47-.94,3.27,3.27,0,0,1,2.47,1,3.56,3.56,0,0,1,1,2.54h-7.09A3.79,3.79,0,0,1,133,9.23Z"/><path class="cls-2" d="M164.46,17.69v2.37h-2.37l-6-6,2.37-2.37ZM11.21,2.4V.05H8.81L0,8.87v2.37l8.81,8.81h2.4V17.7L3.56,10.05ZM174.4,10.05l-7.65,7.65v2.35h2.39L178,11.24V8.86L169.15.05h-2.4V2.4ZM146.82.05h-2.4V2.4l6,6,2.37-2.37ZM164.46,2.4V.05h-2.39L144.42,17.7v2.35h2.4Z"/><path class="cls-2" d="M178.12.72h-1.23V0h3.23v.7h-1.23V4h-.77ZM181,0h.81L183,1.92,184.21,0H185V4h-.74V1.18L183,3.08H183l-1.23-1.9V4H181Z"/></g></g></svg></a> Android SDK
   &#160;<span id="projectnumber">unspecified</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Android SDK </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_section"></a>
Introduction</h1>
<p >These pages provide documentation for Namespaces, Classes, Functions, and Variables within the MobiledgeX Android SDK.</p>
<h1><a class="anchor" id="navigating_section"></a>
Navigating the SDK Documentation</h1>
<p >Use either the tabs or the treeview to find the desired page. There are two main sections: Classes and Modules. Classes will bring you to a list of all classes in the Android MobiledgeX SDK. Modules will bring you to a more organized breakdown of the Android SDK. The Modules are split up into <a class="el" href="group__classes.html">Classes </a>, <a class="el" href="group__functiongroups.html">Function Groups </a>, and <a class="el" href="group__exceptions.html">Exceptions </a>. Each of these modules group similar classes, functions, or exceptions together. For example, all of the <a class="el" href="group__functions__dmeapis.html">MatchingEngine API functions </a> will be found under Modules -&gt; Functions Groups -&gt; MatchingEngine APIs.</p>
<h1><a class="anchor" id="starting_section"></a>
Where to Start?</h1>
<p >The main class that developers will be using is the <a class="el" href="classcom_1_1mobiledgex_1_1matchingengine_1_1_matching_engine.html">com.mobiledgex.matchingengine.MatchingEngine</a> class. This class provides functions to register the user to the Distributed Matching Engine, find the nearest application instance, and then get a connection to that application instance that is ready to be used (See diagram below for workflow). Go to the sections: <a class="el" href="group__functions__dmeapis.html">MatchingEngine APIs </a> and <a class="el" href="group__functions__getconnection.html">GetConnection Functions </a> to get started. </p><div class="image">
<img src="dmeflow.png" alt="" width="800cm" height="500cm"/>
</div>
<h1><a class="anchor" id="how_to"></a>
How To</h1>
<h2><a class="anchor" id="project_setup"></a>
Project Setup</h2>
<p >Create or open an existing Android Studio project.</p>
<p >Add these definitions to your project's top most build.gradle file. In the same directory, create a local.properties file with the artifactory username and password you use to log into <a href="https://console.mobiledgex.net">https://console.mobiledgex.net</a>. Create a login there, if you haven't already. </p><pre class="fragment">Properties properties = new Properties()
properties.load(project.rootProject.file('local.properties').newDataInputStream())
def artifactory_user = properties.getProperty("artifactory_user")
def artifactory_password = properties.getProperty("artifactory_password")

project.ext.mobiledgeXContextUrl = "https://artifactory.mobiledgex.net/artifactory"
project.ext.debugRepoKey = "maven-development"
project.ext.releaseRepoKey = "maven-releases"
project.ext.repoKey = "${debugRepoKey}"
project.ext.grpcVersion = '1.32.1'
</pre><p> Define a repository to pull these depedencies in, using the top most build.gradle file: </p><pre class="fragment">allprojects {
    apply plugin: 'com.jfrog.artifactory'
    repositories {
        maven {
            credentials {
                // Create these variables if you don't have them.
                username artifactory_user
                password artifactory_password
            }
            url "${mobiledgeXContextUrl}/${repoKey}"
        }
        mavenLocal()
        google()
        jcenter()
    }
}
</pre><p> Add these depedencies to your app's build.gradle file: </p><pre class="fragment">implementation 'com.mobiledgex:matchingengine:3.0.0'
implementation 'com.mobiledgex:mel:1.0.11'
implementation 'com.google.guava:guava:29.0-android'

// Dependencies of Matching Engine:
implementation "io.grpc:grpc-stub:${grpcVersion}"

implementation "io.grpc:grpc-okhttp:${grpcVersion}"
implementation "io.grpc:grpc-protobuf-lite:${grpcVersion}"
</pre><p >With the dependencies defined, let Android Studio pull in the depedencies. To get started using MobiledgeX, you need a MatchingEngine instance. Since MatchingEngine needs location permissions, this might be reinitialized onResume():</p>
<h2><a class="anchor" id="setup_matchingengine"></a>
Setup MatchingEngine</h2>
<div class="fragment"><div class="line">        MatchingEngine me = <span class="keyword">new</span> MatchingEngine(context);</div>
</div><!-- fragment --><p> For privacy reasons, there is a flag the application should ask the user for permission before enabling, concerning location usage. This is in addition to normal operating system permissions: </p><div class="fragment"><div class="line">        MatchingEngine.setMatchingEngineLocationAllowed(matchingEngineLocationAllowed);</div>
</div><!-- fragment --><p >Then, register, and find the first closest cloudlet. If not sure of your organization or appInst details, log in and view the app details here: <a href="https://console.mobiledgex.net">https://console.mobiledgex.net</a></p>
<p >Optionally, If interested in dynamic edge migration, you can enable it: </p><div class="fragment"><div class="line">            <span class="comment">// Register the class subscribing to EdgeEvents to the EdgeEventsBus (Guava EventBus interface).</span></div>
<div class="line">            me.setEnableEdgeEvents(<span class="keyword">true</span>); <span class="comment">// default is true.</span></div>
</div><!-- fragment --><h2><a class="anchor" id="setup_edge_events"></a>
Setup EdgeEvents</h2>
<p >Then, attach an EdgeEvents subscriber, described later in this document: </p><div class="fragment"><div class="line">            mEdgeEventsSubscriber = <span class="keyword">new</span> EdgeEventsSubscriber();</div>
<div class="line">            me.getEdgeEventsBus().register(mEdgeEventsSubscriber);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// set a default config.</span></div>
<div class="line">            <span class="comment">// There is also a parameterized version to further customize.</span></div>
<div class="line">            EdgeEventsConfig backgroundEdgeEventsConfig = me.createDefaultEdgeEventsConfig();</div>
<div class="line">            backgroundEdgeEventsConfig.latencyTestType = NetTest.TestType.CONNECT;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// This is the internal port, that has not been remapped to a public port for a particular appInst.</span></div>
<div class="line">            backgroundEdgeEventsConfig.latencyInternalPort = 0; <span class="comment">// 3765; // 0 will favor the first TCP port if found for connect test.</span></div>
<div class="line">            <span class="comment">// Latency config. There is also a very similar location update config.</span></div>
<div class="line">            backgroundEdgeEventsConfig.latencyUpdateConfig.maxNumberOfUpdates = 0; <span class="comment">// Default is 0, which means test forever.</span></div>
<div class="line">            backgroundEdgeEventsConfig.latencyUpdateConfig.updateIntervalSeconds = 7; <span class="comment">// The default is 30.</span></div>
<div class="line">            backgroundEdgeEventsConfig.latencyThresholdTrigger = 186;</div>
</div><!-- fragment --><p> Note that there are 2 configurations set. A application should use only one config, after deciding between performance testing (latencyUpdateConfig), or proximity based (locationUpdateConfig) newCloudlet updates. To use LocationUpdateConfig, where server pushes newCloudlet updates, simply set latencyUpdateConfig = null.</p>
<p >Once defined, you can start monitoring with the following. Monitoring starts when the first successful FIND_FOUND FindCloudlet Reply is returned in the next few lines of code. </p><div class="fragment"><div class="line">            me.startEdgeEventsFuture(backgroundEdgeEventsConfig);</div>
</div><!-- fragment --><h2><a class="anchor" id="register_and_findcloudlet"></a>
Register and FindCloudlet</h2>
<p >Many of these methods have asynchronous Futures versions. The blocking versions below should only be run inside something like a CompletableFuture so that the UI thread is not stuck waiting for a network response. The SDK will also print warnings if running on the UI thread. If you don't have a location service running, see the "Location Callback Example" section.</p>
<p >Create a register client request: </p><div class="fragment"><div class="line">            AppClient.RegisterClientRequest registerClientRequest = me.createDefaultRegisterClientRequest(context, organizationName).build();</div>
</div><!-- fragment --><p >Register, with a sane timeout, like 5 seconds. </p><div class="fragment"><div class="line">                registerReply = me.registerClient(registerClientRequest, GRPC_TIMEOUT_MS);</div>
</div><!-- fragment --><p >Create a default FindCloudlet Request: </p><div class="fragment"><div class="line">            AppClient.FindCloudletRequest findCloudletRequest = me.createDefaultFindCloudletRequest(context, location)</div>
<div class="line">                .setCarrierName(findCloudletCarrierOverride)</div>
<div class="line">                .build();</div>
</div><!-- fragment --><p >FindCloudlet, with a sane timeout, like 5 seconds. </p><div class="fragment"><div class="line">                findCloudletReply1 = me.findCloudlet(findCloudletRequest, GRPC_TIMEOUT_MS);</div>
</div><!-- fragment --><h2><a class="anchor" id="connect_to_appinst"></a>
Connect to the Edge AppInst</h2>
<p >To connect to the edge server instance, use something similar to the following: </p><div class="fragment"><div class="line">            <span class="keywordflow">if</span> (findCloudletReply1.getStatus() == AppClient.FindCloudletReply.FindStatus.FIND_FOUND) {</div>
<div class="line">                <span class="comment">// The edge server host and port can be constructed with the following utility code:</span></div>
<div class="line">                String host = me.getAppConnectionManager().getHost(findCloudletReply1, internalAppInstPortNum);</div>
<div class="line">                <span class="keywordtype">int</span> port = me.getAppConnectionManager().getPublicPort(findCloudletReply1, internalAppInstPortNum);</div>
<div class="line">                Log.i(TAG, <span class="stringliteral">&quot;Host: &quot;</span> + host + <span class="stringliteral">&quot;, Port: &quot;</span> + port);</div>
<div class="line">            }</div>
</div><!-- fragment --><h2><a class="anchor" id="edgeevents_subscriber"></a>
EdgeEventsSubscriber Template</h2>
<p >Here is the EdgeEventsSubscriber class mentioned near the start of the document. The following example code is a Guava EventBus type Subscriber to EdgeEvents. onMessageEvent can be any name as the EventBus will forward it to the matching class type. The FindCloudletEvent variant is good to subscribe in your application. When recieved, the app should save state, and move to the next closer cloudlet.</p>
<div class="fragment"><div class="line">    <span class="comment">// (Guava EventBus Interface)</span></div>
<div class="line">    <span class="comment">// This class encapsulates what an app might implement to watch for edge events. Not every event</span></div>
<div class="line">    <span class="comment">// needs to be implemented. If you just want FindCloudlet, just @Subscribe to FindCloudletEvent.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keyword">class </span>EdgeEventsSubscriber {</div>
<div class="line">        <span class="comment">// Subscribe to error handlers!</span></div>
<div class="line">        @Subscribe</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> onMessageEvent(EdgeEventsConnection.EdgeEventsError error) {</div>
<div class="line">            Log.d(TAG, <span class="stringliteral">&quot;EdgeEvents error reported, reason: &quot;</span> + error);</div>
<div class="line"> </div>
<div class="line">            someText = error.toString();</div>
<div class="line">            updateText(ctx, someText);</div>
<div class="line">            <span class="comment">// Check the App&#39;s EdgeEventsConfig and logs.</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Subscribe to FindCloudletEvent updates to appInst. Reasons to do so include</span></div>
<div class="line">        <span class="comment">// the AppInst Health and Latency spec for this application.</span></div>
<div class="line">        @Subscribe</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> onMessageEvent(FindCloudletEvent findCloudletEvent) {</div>
<div class="line">            Log.i(TAG, <span class="stringliteral">&quot;Cloudlet update, reason: &quot;</span> + findCloudletEvent.trigger);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Connect to new Cloudlet in the event here, preferably in a background task.</span></div>
<div class="line">            Log.i(TAG, <span class="stringliteral">&quot;Cloudlet: &quot;</span> + findCloudletEvent.newCloudlet);</div>
<div class="line"> </div>
<div class="line">            someText = findCloudletEvent.newCloudlet.toString();</div>
<div class="line">            updateText(ctx, someText);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// If MatchingEngine.setAutoMigrateEdgeEventsConnection() has been set to false,</span></div>
<div class="line">            <span class="comment">// let MatchingEngine know with switchedToNextCloudlet() so the new cloudlet can</span></div>
<div class="line">            <span class="comment">// maintain the edge connection.</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Subscribe to ServerEdgeEvents!</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Optional. If you set this event handler, the app will take ownership of raw</span></div>
<div class="line">        <span class="comment">// events off the EdgeEventBus so a custom handler can be written in to fit your application</span></div>
<div class="line">        <span class="comment">// use case better.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// To optionally post messages to the DME, use MatchingEngine&#39;s EdgeEventsConnection.</span></div>
<div class="line">        <span class="comment">//@Subscribe</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> onMessageEvent(AppClient.ServerEdgeEvent event) {</div>
<div class="line">            someText = <span class="keyword">event</span>.toString();</div>
<div class="line">            updateText(ctx, someText);</div>
<div class="line">            <span class="keywordflow">switch</span> (event.getEventType()) {</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_INIT_CONNECTION:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received Init response: &quot;</span> + event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_APPINST_HEALTH:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received: AppInst Health: &quot;</span> + event);</div>
<div class="line">                    handleAppInstHealth(event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_CLOUDLET_STATE:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received: Cloutlet State event: &quot;</span> + event);</div>
<div class="line">                    handleCloudletState(event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_CLOUDLET_MAINTENANCE:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received: Cloutlet Maintenance event.&quot;</span> + event);</div>
<div class="line">                    handleCloudletMaintenance(event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_LATENCY_PROCESSED:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received: Latency has been processed on server: &quot;</span> + event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_LATENCY_REQUEST:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received: Latency has been requested to be tested (client perspective): &quot;</span> + event);</div>
<div class="line">                    handleLatencyRequest(event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_CLOUDLET_UPDATE:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received: Server pushed a new FindCloudletReply to switch to: &quot;</span> + event);</div>
<div class="line">                    handleFindCloudletServerPush(event);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_ERROR:</div>
<div class="line">                    Log.d(TAG,<span class="stringliteral">&quot;Received: An edgeEvents error: &quot;</span> + event.getErrorMsg());</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> EVENT_UNKNOWN:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Received UnknownEvent.&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    System.out.println(<span class="stringliteral">&quot;Event Received: &quot;</span> + event.getEventType());</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><h2><a class="anchor" id="location_callback_example"></a>
Location Callback Example and Posting Updates for Cloudlet Updates</h2>
<p >It is possible to directly feed location into the EdgeEvents connection to the server. If there is a closer edge server, the app will be notified about a better cloudlet. Location permissions is app controled, as the app UI controls permission prompts between onPause() and onResume() states, where the the user might remove location permisisons. </p><div class="fragment"><div class="line">        mLocationCallback = <span class="keyword">new</span> LocationCallback() {</div>
<div class="line">            @Override</div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onLocationResult(LocationResult locationResult) {</div>
<div class="line">                <span class="keywordflow">if</span> (locationResult == <span class="keyword">null</span>) {</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">                String clientLocText = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">                mLastLocationResult = locationResult;</div>
<div class="line">                <span class="comment">// Post into edgeEvents updater:</span></div>
<div class="line">                me.getEdgeEventsConnectionFuture()</div>
<div class="line">                        .thenApply(connection -&gt; {</div>
<div class="line">                            <span class="keywordflow">if</span> (connection != <span class="keyword">null</span>) {</div>
<div class="line">                                connection.postLocationUpdate(locationResult.getLastLocation());</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">return</span> <span class="keyword">null</span>;</div>
<div class="line">                        });</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (Location location : locationResult.getLocations()) {</div>
<div class="line">                    <span class="comment">// Update UI with client location data</span></div>
<div class="line">                    clientLocText += <span class="stringliteral">&quot;[&quot;</span> + location.toString() + <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">                }</div>
<div class="line">                TextView tv = findViewById(R.id.client_location_content);</div>
<div class="line">                tv.setText(clientLocText);</div>
<div class="line">            }</div>
<div class="line">        };</div>
</div><!-- fragment --><p> To request android location service to run in the background, you need google play services, please read here: <a href="https://developer.android.com/training/location/request-updates#java">https://developer.android.com/training/location/request-updates#java</a></p>
<h2><a class="anchor" id="matchingengine_permissions"></a>
MatchingEngine Permission Utility</h2>
<p >The application should prompt for location permissions, as well as read the network state for edge server state management. Here's example to check using <a class="el" href="classcom_1_1mobiledgex_1_1matchingengine_1_1util_1_1_request_permissions.html">com.mobiledgex.matchingengine.util.RequestPermissions</a>. It has getNeededPermissions() to check current missing permissions. Be sure to add needed permissions to the app's AndroidManifest.xml file. Be sure to include INTERNET permissions. </p><div class="fragment"><div class="line">        mRpUtil = <span class="keyword">new</span> RequestPermissions();</div>
</div><!-- fragment --> <div class="fragment"><div class="line">        <span class="comment">// As of Android 23, permissions can be asked for while the app is still running.</span></div>
<div class="line">        <span class="keywordflow">if</span> (mRpUtil.getNeededPermissions(appCompatActivity).size() &gt; 0) {</div>
<div class="line">            mRpUtil.requestMultiplePermissions(appCompatActivity);</div>
<div class="line">        }</div>
</div><!-- fragment --><p> The above asks for READ_PHONE_STATE, ACCESS_COARSE_LOCATION, and ACCESS_FINE_LOCATION.</p>
<h2><a class="anchor" id="edgeevents_subscriber_template"></a>
Managing Resources</h2>
<p >If the application onPause() is called, consider calling stopEdgeEvents() to free resources. Re-enable at onResume().</p>
<h2><a class="anchor" id="edgeevents_subscriber_template"></a>
Managing Resources</h2>
<p >When the app needs to quit or free resources, call close(): </p><div class="fragment"><div class="line"> </div>
<div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> onDestroy() {</div>
<div class="line">        super.onDestroy();</div>
<div class="line">        <span class="keywordflow">if</span> (me != <span class="keyword">null</span>) {</div>
<div class="line">            me.getEdgeEventsBus().unregister(mEdgeEventsSubscriber);</div>
<div class="line">            me.close();</div>
<div class="line">            me = <span class="keyword">null</span>;</div>
<div class="line">        }</div>
<div class="line">        mEdgeEventsSubscriber = <span class="keyword">null</span>;</div>
<div class="line">        ctx = <span class="keyword">null</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.18-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
